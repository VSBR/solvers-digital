#!/usr/bin/python
# -*- coding: utf-8 -*-
# node_moduleディレクトリをフラットに移動する
#

import os, re, sys, shutil, stat
import codecs
from optparse import OptionParser


if __name__ == '__main__':
    
    wd = os.path.dirname(__file__)
    
    moved = True
    while moved:
        moved = False
        for path, dirs, files in os.walk(wd):
            for d in dirs:
                if d == 'node_modules':
                    dpath = os.path.join(path, d)
                    cmd = 'mv -f {}/* {}'.format(dpath, wd)
                    print cmd
                    os.system(cmd)
                    cmd = 'rm -rf {}'.format(dpath)
                    print cmd
                    os.system(cmd)
                    moved = True
                    break
            if moved:
                break
        
    for path, dirs, files in os.walk(wd):
        for f in files:
            fpath = os.path.join(path, f)
            mode = os.stat(fpath).st_mode
            if stat.S_ISLNK(mode):
                cmd = 'rm -f {}'.format(fpath)
                print cmd
                os.system(cmd)
                
    
